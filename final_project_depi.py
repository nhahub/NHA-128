# -*- coding: utf-8 -*-
"""Final Project_DEPI.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1tOxdr6mqJhJBukBV7A1yNQy2azcyXCmy
"""

# âœ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹Ø±ÙŠÙ Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
import pandas as pd
import numpy as np
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import LabelEncoder, StandardScaler
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import accuracy_score, confusion_matrix, classification_report
import matplotlib.pyplot as plt
import seaborn as sns

# ============================================
# ğŸ“‚ Load Dataset
# ============================================

from google.colab import files
uploaded = files.upload()  # Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ

import pandas as pd

# Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ù„Ù Ù…ØªØ®Ø·ÙŠ Ø£ÙˆÙ„ ØµÙÙŠÙ†
df = pd.read_excel("cleaned railway data (1).xlsx")  # Ø£Ùˆ .csv Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù

# Ø§Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 5 ØµÙÙˆÙ
df.head()

df.dropna(how='all', inplace=True)
df['Price'] = pd.to_numeric(df['Price'], errors='coerce')
df['Delay'] = pd.to_numeric(df['Delay'], errors='coerce')

date_cols = ['Date_of_Purchase', 'Date_of_Journey']
for col in date_cols:
    df[col] = pd.to_datetime(df[col], errors='coerce')

print(df.info())

df.fillna({'Purchase_Type':'Unknown',
           'Payment_Method':'Unknown',
           'Railcard':'None',
           'Journey_Status':'Unknown'}, inplace=True)

label_cols = ['Purchase_Type', 'Payment_Method', 'Railcard',
              'Ticket_Class', 'Ticket_Type', 'Departure_Station',
              'Arrival_Destination', 'Journey_Status', 'Reason_for_Delay',
              'Refund_Request']

encoder = LabelEncoder()
for col in label_cols:
    df[col] = encoder.fit_transform(df[col].astype(str))

X = df[['Purchase_Type','Payment_Method','Railcard','Ticket_Class',
        'Ticket_Type','Price','Departure_Station','Arrival_Destination','Delay']]
y = df['Journey_Status']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X_train_scaled, y_train)

y_pred = model.predict(X_test_scaled)

print("âœ… Accuracy:", accuracy_score(y_test, y_pred))
print("\nğŸ“‹ Classification Report:\n", classification_report(y_test, y_pred))

# Ù…ØµÙÙˆÙØ© Ø§Ù„Ø§Ø±ØªØ¨Ø§Ùƒ
cm = confusion_matrix(y_test, y_pred)
sns.heatmap(cm, annot=True, fmt="d", cmap="Blues")
plt.title("Confusion Matrix")
plt.xlabel("Predicted")
plt.ylabel("Actual")
plt.show()

# ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù‚Ø© Ø¨ÙŠÙ† Ø§Ù„ØªØ£Ø®ÙŠØ± ÙˆØ§Ù„Ø³Ø¹Ø±
plt.figure(figsize=(8,5))
sns.scatterplot(x='Price', y='Delay', hue='Journey_Status', data=df)
plt.title("Relation Between Ticket Price and Delay")
plt.show()

# Ø£Ù‡Ù… Ø§Ù„Ø¹ÙˆØ§Ù…Ù„ Ø§Ù„Ù„ÙŠ Ø¨ØªØ£Ø«Ø± Ø¹Ù„Ù‰ Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©
importances = pd.Series(model.feature_importances_, index=X.columns)
importances.sort_values(ascending=False).plot(kind='bar', figsize=(8,5), title="Feature Importance")
plt.show()

plt.figure(figsize=(8,5))
sns.barplot(x='Journey_Status', y='Price', data=df, palette='coolwarm')
plt.title("Average Ticket Price per Journey Status")
plt.show()

from sklearn.model_selection import cross_val_score

scores = cross_val_score(model, X_train_scaled, y_train, cv=5)
print("ğŸ” Cross-Validation Accuracy:", scores.mean())

from sklearn.tree import DecisionTreeClassifier
dt_model = DecisionTreeClassifier(random_state=42)
dt_model.fit(X_train_scaled, y_train)
dt_pred = dt_model.predict(X_test_scaled)

print("ğŸŒ³ Decision Tree Accuracy:", accuracy_score(y_test, dt_pred))

importances.sort_values().plot(kind='barh', figsize=(8,5), color='coral')
plt.title("Feature Importance (Horizontal View)")
plt.show()

## ğŸ’¡ Ø§Ù„Ø§Ø³ØªÙ†ØªØ§Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:
#Ù…Ù† Ø®Ù„Ø§Ù„ ØªØ­Ù„ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø­Ù„Ø§Øª ÙˆØ¬Ø¯Ù†Ø§ Ø£Ù†:
#- **Ø³Ø¹Ø± Ø§Ù„ØªØ°ÙƒØ±Ø©** Ùˆ**Ø§Ù„ÙˆØ¬Ù‡Ø©** Ù‡Ù…Ø§ Ø§Ù„Ø¹Ø§Ù…Ù„Ø§Ù† Ø§Ù„Ø£ÙƒØ«Ø± ØªØ£Ø«ÙŠØ±Ù‹Ø§ Ø¹Ù„Ù‰ Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© ØªØ£Ø®ÙŠØ± Ø§Ù„Ø±Ø­Ù„Ø©.
#- Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ø£ØºÙ„Ù‰ Ø³Ø¹Ø±Ù‹Ø§ ØªÙ…ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø£ÙƒØ«Ø± Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯.
#- Ù†Ù…ÙˆØ°Ø¬ Random Forest Ø­Ù‚Ù‚ Ø¯Ù‚Ø© Ø¹Ø§Ù„ÙŠØ© ØªØ¬Ø§ÙˆØ²Øª 91%.
#- ÙŠÙ…ÙƒÙ† Ù„Ù„Ø´Ø±ÙƒØ© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ù…Ø¹Ø±Ø¶Ø© Ù„Ù„ØªØ£Ø®ÙŠØ± Ù…Ø³Ø¨Ù‚Ù‹Ø§ ÙˆØªØ­Ø³ÙŠÙ† Ø±Ø¶Ø§ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡.